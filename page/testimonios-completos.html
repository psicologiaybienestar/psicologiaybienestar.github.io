<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todos los Comentarios - Psicología & Bienestar</title>
    <link rel="icon" type="image/png" href="/assets/logo-ico.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@splidejs/splide@4.1.3/dist/js/splide.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@splidejs/splide@4.1.3/dist/css/splide.min.css" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .perspective {
            perspective: 1000px;
        }

        .transform-style-preserve-3d {
            transform-style: preserve-3d;
        }

        .backface-hidden {
            backface-visibility: hidden;
        }

        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        .overflow-y-auto::-webkit-scrollbar {
            display: none;
            /* oculta scroll en caso de desborde */
        }

        html {
            scroll-behavior: smooth;
        }

        @font-face {
            font-family: "Sego Serif";
            src: url("/fonts/sego-serif.ttf") format("truetype");
            font-weight: normal;
            font-style: normal;
        }

        .font-sego {
            font-family: "Sego Serif", serif;
        }
    </style>
    <script>
        // Recargar la página al hacer clic en los enlaces a Inicio
        const inicioLinks = document.querySelectorAll('a[href="index.html"]');
        inicioLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                window.location.reload(true);
            });
        });

        // Recargar la página al hacer clic en el enlace a Servicios Empresariales
        const serviciosEmpresarialesLink = document.querySelector('a[href="servicios-empresariales.html"]');
        if (serviciosEmpresarialesLink) {
            serviciosEmpresarialesLink.addEventListener('click', (event) => {
                window.location.reload(true);
            });
        }
        // Recargar la página al hacer clic en el enlace a Testimonios Completos
        const testimoniosCompletosLink = document.querySelector('a[href="page/testimonios-completos.html"]');
        if (testimoniosCompletosLink) {
            testimoniosCompletosLink.addEventListener('click', (event) => {
                window.location.reload(true); // Forzar la recarga desde el servidor
            });
        }
    </script>
    <!-- adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5397310873335886"
        crossorigin="anonymous"></script>
</head>

<body class="bg-white text-gray-800">

    <header class="bg-[#66a6da] text-white shadow fixed w-full top-0 z-50">
        <div class="container mx-auto flex justify-between items-center p-4">
            <div class="flex items-center space-x-2">
                <img src="/assets/logo.png" alt="Logo Empresa" class="h-10 w-10" />
                <span class="text-xl font-bold font-sego">Psicología & Bienestar</span>
            </div>

            <button id="menu-toggle" class="md:hidden focus:outline-none">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>

            <nav id="menu" class="hidden md:flex space-x-4 text-sm font-semibold">
                <a href="/index.html" class="hover:text-gray-200">Inicio</a>
                <a href="/index.html#nosotros" class="hover:text-gray-200">Nosotros</a>
                <a href="/index.html#servicios" class="hover:text-gray-200">Servicios</a>
                <a href="/index.html#equipo" class="hover:text-gray-200">Equipo</a>
                <a href="#contacto" class="hover:text-gray-200">Contacto</a>
            </nav>
        </div>

        <div id="mobile-menu" class="md:hidden hidden bg-[#66a6da] px-4 pb-4">
            <a href="/index.html" class="block py-2 hover:text-gray-200">Inicio</a>
            <a href="/index.html#nosotros" class="block py-2 hover:text-gray-200">Nosotros</a>
            <a href="/index.html#servicios" class="block py-2 hover:text-gray-200">Servicios</a>
            <a href="/index.html#equipo" class="block py-2 hover:text-gray-200">Equipo</a>
            <a href="#contacto" class="block py-2 hover:text-gray-200">Contacto</a>
        </div>
    </header>

    <section class="py-20 px-6 md:px-20 bg-[#f4f9ff] mt-16" id="servicios-empresariales">
        <h2 class="text-3xl md:text-4xl font-bold text-center text-[#627eff] mb-6">
            Comentarios de Nuestros Clientes
        </h2>

        <div id="all-testimonials-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-10">
            <!-- Testimonials will be loaded here by JavaScript -->
        </div>

        <div class="text-center mt-10">
            <a href="/index.html"
                class="inline-block bg-[#627eff] text-white py-2 px-6 rounded-lg shadow hover:bg-[#53c6e4] transition">
                ← Volver a Inicio
            </a>
        </div>
    </section>


    <div class="mt-20 max-w-2xl mx-auto bg-white shadow-lg rounded-xl p-6 scroll-mt-20" id="contacto">
        <h2 class="text-2xl font-semibold text-[#627eff] mb-4 text-center">Contáctanos</h2>

        <div id="successMessage"
            class="hidden text-green-700 bg-green-100 border border-green-300 rounded-lg px-4 py-3 mb-4 text-center">
            ¡Gracias por contactarnos! Tu mensaje fue enviado exitosamente.
        </div>

        <form id="contactForm" action="https://formspree.io/f/mblgpnvb" method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-medium">Nombre</label>
                <input type="text" name="nombre" required
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#66a6da]" />
            </div>
            <div>
                <label class="block text-sm font-medium">Correo electrónico</label>
                <input type="email" name="email" required
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#66a6da]" />
            </div>
            <div>
                <label class="block text-sm font-medium">Teléfono</label>
                <input type="tel" name="telefono" pattern="[0-9+ ]+" placeholder="+57 300 123 4567" required
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#66a6da]" />
            </div>
            <div>
                <label class="block text-sm font-medium">Mensaje</label>
                <textarea name="mensaje" rows="4" required
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#66a6da]"></textarea>
            </div>
            <button type="submit"
                class="bg-[#627eff] hover:bg-[#53c6e4] text-white px-6 py-2 rounded-lg transition w-full">
                Enviar mensaje
            </button>
        </form>
    </div>

    <footer class="bg-[#66a6da] text-white text-center py-8 mt-12">
        <div class="container mx-auto">
            <p class="font-sego text-sm mb-2">Psicología & Bienestar © 2025. Todos los derechos reservados.</p>
        </div>
    </footer>

    <div class="fixed top-1/3 left-0 z-40 flex flex-col space-y-3 px-2">
        <a href="https://www.instagram.com/serviciospsicobienestar?utm_source=qr&igsh=NmtoOWFqMnZwMHY1" target="_blank"
            class="group relative flex items-center">
            <div class="bg-pink-500 hover:bg-pink-600 p-3 rounded-r-full shadow-lg transition duration-300">
                <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/instagram.svg" alt="Instagram"
                    class="w-5 h-5" />
            </div>
            <span
                class="absolute left-12 bg-pink-500 text-white text-xs px-3 py-1 rounded shadow-lg opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100 transform transition-all duration-300 origin-left whitespace-nowrap">
                Visita nuestro Instagram
            </span>
        </a>

        <a href="https://www.facebook.com/share/1A9WZs7XCb/" target="_blank" class="group relative flex items-center">
            <div class="bg-blue-600 hover:bg-blue-700 p-3 rounded-r-full shadow-lg transition duration-300">
                <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/facebook.svg" alt="Facebook"
                    class="w-5 h-5" />
            </div>
            <span
                class="absolute left-12 bg-blue-600 text-white text-xs px-3 py-1 rounded shadow-lg opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100 transform transition-all duration-300 origin-left whitespace-nowrap">
                Visita nuestro Facebook
            </span>
        </a>
    </div>

    <a href="https://wa.me/573164603881" target="_blank" class="fixed bottom-6 right-6 z-50 group">
        <div
            class="relative flex items-center justify-center bg-[#25D366] hover:bg-green-600 w-14 h-14 rounded-full shadow-lg transition-colors duration-300">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/whatsapp.svg" alt="WhatsApp"
                class="w-7 h-7 text-white" />
            <span
                class="absolute right-16 bg-[#25D366] text-white text-sm px-3 py-1 rounded-lg shadow-lg opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100 transform transition-all duration-300 origin-right whitespace-nowrap">
                Escríbenos por WhatsApp
            </span>
        </div>
    </a>

    <script>
        const form = document.getElementById("contactForm");
        const successMessage = document.getElementById("successMessage");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const data = new FormData(form);
            const action = form.getAttribute("action");

            const response = await fetch(action, {
                method: "POST",
                body: data,
                headers: {
                    Accept: "application/json",
                },
            });

            if (response.ok) {
                form.reset();
                successMessage.classList.remove("hidden");
                setTimeout(() => {
                    successMessage.classList.add("hidden");
                }, 5000);
            }
        });
    </script>
    <script>
        const menuToggle = document.getElementById("menu-toggle");
        const mobileMenu = document.getElementById("mobile-menu");
        const mobileMenuItems = document.querySelectorAll("#mobile-menu a"); // Selector corregido

        menuToggle.addEventListener("click", () => {
            mobileMenu.classList.toggle("hidden");
        });

        mobileMenuItems.forEach(item => {
            item.addEventListener("click", () => {
                if (window.innerWidth < 768) {
                    mobileMenu.classList.add("hidden");
                }
            });
        });
    </script>

<script>
    const googleSheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9gc0iLBVHnuWopuxijsTupBn_tvZ-B7D3b4WBVZ-meyKF61a8o24Qy1FQ5fxUYL7DaabkkAgILjac/pub?gid=421205038&single=true&output=csv';
    const testimoniosContainer = document.getElementById('carousel-wrapper'); // Asegura que este es el ID correcto
    let allTestimonials = [];
    let currentIndex = 0;
    let itemsPerPage = 4; // Por defecto, 4 items por página (2 filas de 2)

    // Función para determinar itemsPerPage basado en el tamaño de la pantalla
    function updateItemsPerPage() {
         if (window.innerWidth <= 480) {
             itemsPerPage = 1; // En móviles, mostrar 1 item por página
         } else if (window.innerWidth <= 768) {
              itemsPerPage = 2; // En tablets, mostrar 2 items por página (si prefieres)
         } else {
             itemsPerPage = 4; // En pantallas grandes, mostrar 4 items por página
         }
    }

    // Llamar al inicio para establecer itemsPerPage inicial
    updateItemsPerPage();


    function showTestimonials(index) {
        if (!testimoniosContainer) {
             console.error("Error: Elemento con ID 'carousel-wrapper' no encontrado.");
             return; // Salir si el contenedor no existe
        }
        testimoniosContainer.innerHTML = '';
        const startIndex = index * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, allTestimonials.length);

        // Determinar cuántos testimonios mostrar por fila en el diseño flexbox
        const testimonialsPerFlexRow = itemsPerPage > 1 && window.innerWidth > 480 ? 2 : 1; // 2 por fila solo si itemsPerPage > 1 y NO estamos en móviles

        // Si solo se muestra 1 item por página, no necesitamos la estructura de fila flex adicional
        if (testimonialsPerFlexRow === 1) {
             for (let i = startIndex; i < endIndex; i++) {
                 const testimonioData = allTestimonials[i];
                 const fechaStr = testimonioData["Fecha"];
                 let formattedDate = 'Fecha Inválida';
                 if (fechaStr) {
                      const parts = fechaStr.split('/');
                      if (parts.length === 3) {
                           const day = parseInt(parts[0]);
                           const month = parseInt(parts[1]) - 1; // JavaScript months are 0-indexed
                           const year = parseInt(parts[2]);
                           const date = new Date(year, month, day);
                           if (!isNaN(date.getTime())) { // Verificar si la fecha es válida
                                formattedDate = date.toLocaleDateString('es-CO', { year: 'numeric', month: 'numeric', day: 'numeric' });
                           } else {
                                console.error("Fecha inválida construida desde partes:", fechaStr);
                           }
                      } else {
                           console.error("Formato de fecha incorrecto al dividir:", fechaStr);
                      }
                 } else {
                      console.warn("La cadena de fecha está vacía para un testimonio.");
                 }

                 let ratingDisplay = '';
                 const ratingValue = testimonioData["Calificación"];
                 if (ratingValue && !isNaN(parseInt(ratingValue))) { // Verificar si hay valor antes de parseInt
                      const numStars = parseInt(ratingValue);
                      for (let j = 0; j < numStars; j++) {
                           ratingDisplay += '★';
                      }
                 } else if (ratingValue) {
                      ratingDisplay = ratingValue;
                 }

                 const testimonioHTML = `
                      <div class="bg-gray-100 rounded-lg p-6 shadow-md flex-1">
                          <div class="flex justify-between items-center mb-2">
                              <p class="text-sm font-semibold text-[#627eff]">- ${testimonioData["Nombre Completo"]}</p>
                              ${ratingDisplay ? `<div class="text-yellow-500">${ratingDisplay}</div>` : ''}
                          </div>
                          <p class="text-gray-700 italic mb-2"><span class="math-inline">\{testimonioData\["Tu Testimonio"\]\}</p\>
<p class\="text\-xs text\-gray\-500"\></span>{formattedDate}</p>
                      </div>
                 `;
                 testimoniosContainer.innerHTML += testimonioHTML; // Añadir directamente al contenedor principal
             }
        } else { // Si se muestran varios items por fila (escritorio/tablet)
             const totalRows = Math.ceil((endIndex - startIndex) / testimonialsPerFlexRow);
             for (let row = 0; row < totalRows; row++) {
                 const rowContainer = document.createElement('div');
                 rowContainer.classList.add('flex', 'gap-6', 'mb-4'); // Clases para la fila flex

                 for (let col = 0; col < testimonialsPerFlexRow; col++) {
                      const currentTestimonioIndex = startIndex + row * testimonialsPerFlexRow + col;
                      if (currentTestimonioIndex < endIndex) {
                           const testimonioData = allTestimonials[currentTestimonioIndex];

                           const fechaStr = testimonioData["Fecha"];
                           let formattedDate = 'Fecha Inválida';
                           if (fechaStr) {
                                const parts = fechaStr.split('/');
                                if (parts.length === 3) {
                                     const day = parseInt(parts[0]);
                                     const month = parseInt(parts[1]) - 1; // JavaScript months are 0-indexed
                                     const year = parseInt(parts[2]);
                                     const date = new Date(year, month, day);
                                     if (!isNaN(date.getTime())) { // Verificar si la fecha es válida
                                          formattedDate = date.toLocaleDateString('es-CO', { year: 'numeric', month: 'numeric', day: 'numeric' });
                                     } else {
                                          console.error("Fecha inválida construida desde partes:", fechaStr);
                                     }
                                } else {
                                     console.error("Formato de fecha incorrecto al dividir:", fechaStr);
                                }
                           } else {
                                console.warn("La cadena de fecha está vacía para un testimonio.");
                           }

                           let ratingDisplay = '';
                           const ratingValue = testimonioData["Calificación"];
                           if (ratingValue && !isNaN(parseInt(ratingValue))) { // Verificar si hay valor antes de parseInt
                                const numStars = parseInt(ratingValue);
                                for (let j = 0; j < numStars; j++) {
                                     ratingDisplay += '★';
                                }
                           } else if (ratingValue) {
                                ratingDisplay = ratingValue;
                           }

                           const testimonioHTML = `
                               <div class="bg-gray-100 rounded-lg p-6 shadow-md flex-1">
                                   <div class="flex justify-between items-center mb-2">
                                       <p class="text-sm font-semibold text-[#627eff]">- ${testimonioData["Nombre Completo"]}</p>
                                       ${ratingDisplay ? `<div class="text-yellow-500">${ratingDisplay}</div>` : ''}
                                   </div>
                                   <p class="text-gray-700 italic mb-2"><span class="math-inline">\{testimonioData\["Tu Testimonio"\]\}</p\>
<p class\="text\-xs text\-gray\-500"\></span>{formattedDate}</p>
                               </div>
                           `;
                           rowContainer.innerHTML += testimonioHTML;
                      } else {
                           // Añadir un div vacío para mantener el diseño flex si hay menos testimonios en la última fila/columna
                           rowContainer.innerHTML += '<div class="flex-1"></div>';
                      }
                 }
                 testimoniosContainer.appendChild(rowContainer);
             }
             // La lógica para eliminar la última fila vacía podría necesitar ajuste.
            if (testimoniosContainer.lastChild && testimoniosContainer.lastChild.classList.contains('flex') && testimoniosContainer.lastChild.innerHTML.trim() === '<div class="flex-1"></div>'.repeat(testimonialsPerFlexRow).trim()) {
                testimoniosContainer.removeChild(testimoniosContainer.lastChild);
            }
        }

    }

    function updateNavigationButtons() {
        const prevButton = document.getElementById('prev-testimonial');
        const nextButton = document.getElementById('next-testimonial');
        const totalPages = Math.ceil(allTestimonials.length / itemsPerPage);


        if (prevButton) prevButton.disabled = currentIndex === 0;
        if (nextButton) nextButton.disabled = currentIndex >= totalPages - 1;
    }

    function nextTestimonials() {
        const totalPages = Math.ceil(allTestimonials.length / itemsPerPage);
        currentIndex = Math.min(currentIndex + 1, totalPages - 1);
        showTestimonials(currentIndex);
        updateNavigationButtons();
        resetAutoSlide();
    }

    function prevTestimonials() {
        currentIndex = Math.max(currentIndex - 1, 0);
        showTestimonials(currentIndex);
        updateNavigationButtons();
        resetAutoSlide();
    }

    let autoSlideInterval;
    const autoSlideDelay = 5000; // 5 segundos

    function startAutoSlide() {
        stopAutoSlide(); // Asegurarse de que no haya múltiples intervalos corriendo
        autoSlideInterval = setInterval(() => {
            const totalPages = Math.ceil(allTestimonials.length / itemsPerPage);
            if (totalPages > 1) { // Solo avanzar si hay más de una página
               currentIndex = (currentIndex + 1) % totalPages; // Ciclar al siguiente índice
               showTestimonials(currentIndex);
               updateNavigationButtons();
            } else {
                stopAutoSlide(); // Detener auto-slide si solo hay una página
            }
        }, autoSlideDelay);
    }


    function stopAutoSlide() {
        clearInterval(autoSlideInterval);
    }

    function resetAutoSlide() {
        stopAutoSlide();
        startAutoSlide();
    }

    document.addEventListener('DOMContentLoaded', function() {
         // Recalcular itemsPerPage por si la ventana se redimensionó antes de DOMContentLoaded
         updateItemsPerPage();


        fetch(googleSheetURL)
            .then(response => response.text())
            .then(csvData => {
                 // Intenta manejar comas dentro de comillas dobles y trimar encabezados/valores
                const rows = csvData.split('\n').map(row => row.trim());
                if (rows.length <= 1) {
                    const container = document.getElementById('carousel-wrapper');
                    if (container) container.innerHTML = '<p>No hay testimonios disponibles.</p>';
                    // Deshabilitar botones si no hay testimonios
                     const prevButton = document.getElementById('prev-testimonial');
                     const nextButton = document.getElementById('next-testimonial');
                     if (prevButton) prevButton.disabled = true;
                     if (nextButton) nextButton.disabled = true;
                     stopAutoSlide(); // Detener auto-slide si no hay testimonios
                    return;
                }

                // Mejorar la lectura de encabezados trimando los espacios
                const headers = rows[0].split(',').map(header => header.trim());
                const nombreIndex = headers.indexOf('Nombre Completo');
                const testimonioIndex = headers.indexOf('Tu Testimonio');
                const calificacionIndex = headers.indexOf('Calificación');
                const fechaIndex = headers.indexOf('Fecha');
                // Añadimos console.log para depurar los índices encontrados
                console.log("Encabezados detectados:", headers);
                console.log("Índice Nombre Completo:", nombreIndex);
                console.log("Índice Tu Testimonio:", testimonioIndex);
                console.log("Índice Calificación:", calificacionIndex);
                console.log("Índice Fecha:", fechaIndex);


                if (nombreIndex === -1 || testimonioIndex === -1 || calificacionIndex === -1 || fechaIndex === -1) {
                    console.error('Las columnas necesarias ("Nombre Completo", "Tu Testimonio", "Calificación", "Fecha") no se encontraron en el CSV o tienen nombres incorrectos/espacios adicionales.');
                    const container = document.getElementById('carousel-wrapper');
                    if (container) container.innerHTML = '<p class="text-red-500">Error al leer los testimonios (columnas no encontradas).</p>';
                     // Deshabilitar botones si hay error de columnas
                     const prevButton = document.getElementById('prev-testimonial');
                     const nextButton = document.getElementById('next-testimonial');
                     if (prevButton) prevButton.disabled = true;
                     if (nextButton) nextButton.disabled = true;
                     stopAutoSlide(); // Detener auto-slide en caso de error
                    return;
                }

                const fetchedTestimonials = [];
                for (let i = 1; i < rows.length; i++) {
                     const row = rows[i];
                     if (!row) continue; // Saltar filas vacías

                     // Intentar parsear la fila CSV manualmente para manejar comas dentro de comillas dobles
                     const values = [];
                     let inQuotes = false;
                     let currentValue = '';
                     for (let j = 0; j < row.length; j++) {
                         const char = row[j];

                         if (char === '"' && (j === 0 || row[j-1] === ',' || /\s/.test(row[j-1]))) {
                             inQuotes = true;
                             continue;
                         }
                          if (char === '"' && (j === row.length - 1 || row[j+1] === ',' || /\s/.test(row[j+1]))) {
                             inQuotes = false;
                             continue;
                         }


                         if (char === ',' && !inQuotes) {
                             values.push(currentValue.trim());
                             currentValue = '';
                         } else {
                             currentValue += char;
                         }
                     }
                     values.push(currentValue.trim()); // Añadir el último valor trimado


                     // Verificar si tenemos suficientes columnas antes de intentar acceder a ellas
                     // y que los índices encontrados son válidos
                     if (values.length > Math.max(nombreIndex, testimonioIndex, calificacionIndex, fechaIndex) &&
                         nombreIndex !== -1 && testimonioIndex !== -1 && calificacionIndex !== -1 && fechaIndex !== -1) {

                        const testimonioData = {};
                        testimonioData["Nombre Completo"] = values[nombreIndex]; // Ya trimado
                        testimonioData["Tu Testimonio"] = values[testimonioIndex]; // Ya trimado
                        testimonioData["Calificación"] = values[calificacionIndex]; // Ya trimado
                        testimonioData["Fecha"] = values[fechaIndex]; // Ya trimado

                        fetchedTestimonials.push(testimonioData);

                        // Añadimos console.log para depurar los datos de cada testimonio
                        console.log("Datos del testimonio (fila", i, "):", testimonioData);

                     } else {
                         console.warn("Saltando fila con datos incompletos, índices inválidos o error de parseo:", row);
                     }
                }

                allTestimonials = fetchedTestimonials;

                // Limitar a 12 testimonios para el carrusel si hay más
                if (allTestimonials.length > 12) {
                     allTestimonials = allTestimonials.slice(0, 12);
                }

                 // Si después de limitar no hay testimonios, mostrar mensaje y deshabilitar botones
                 if (allTestimonials.length === 0) {
                     const container = document.getElementById('carousel-wrapper');
                     if (container) container.innerHTML = '<p>No hay testimonios disponibles.</p>';
                     const prevButton = document.getElementById('prev-testimonial');
                     const nextButton = document.getElementById('next-testimonial');
                     if (prevButton) prevButton.disabled = true;
                     if (nextButton) nextButton.disabled = true;
                     stopAutoSlide();
                     return;
                 }


                showTestimonials(currentIndex);
                updateNavigationButtons();
                startAutoSlide(); // Iniciar el carrusel automático


                 // Añadir listener para redimensionamiento para ajustar itemsPerPage y recargar la vista del carrusel
                 window.addEventListener('resize', () => {
                      const oldItemsPerPage = itemsPerPage;
                      updateItemsPerPage(); // Recalcular itemsPerPage
                      if (itemsPerPage !== oldItemsPerPage) {
                          currentIndex = 0; // Reset al índice 0 al cambiar el número de items por página
                          showTestimonials(currentIndex);
                          updateNavigationButtons();
                          resetAutoSlide(); // Reiniciar auto-slide con la nueva configuración
                      }
                 });


            })
            .catch(error => {
                console.error('Error al obtener los testimonios desde Google Sheets (CSV):', error);
                const container = document.getElementById('carousel-wrapper');
                if (container) container.innerHTML = '<p class="text-red-500">No se pudieron cargar los testimonios (error de red o CSV).</p>';
                 // Deshabilitar botones si hay error en la carga
                 const prevButton = document.getElementById('prev-testimonial');
                 const nextButton = document.getElementById('next-testimonial');
                 if (prevButton) prevButton.disabled = true;
                 if (nextButton) nextButton.disabled = true;
                 stopAutoSlide(); // Detener auto-slide en caso de error
            });

        const prevButton = document.getElementById('prev-testimonial');
        const nextButton = document.getElementById('next-testimonial');

        if (prevButton) prevButton.addEventListener('click', prevTestimonials);
        if (nextButton) nextButton.addEventListener('click', nextTestimonials);

        // Manejar eventos de hover en el contenedor del carrusel para pausar el auto-slide
        const carouselContainerElement = document.getElementById('carousel-container'); // O el elemento que envuelve el carrusel visualmente
        if (carouselContainerElement) {
             carouselContainerElement.addEventListener('mouseenter', stopAutoSlide);
             carouselContainerElement.addEventListener('mouseleave', startAutoSlide);
        } else {
             console.warn("Elemento #carousel-container no encontrado. El auto-slide no se pausará al pasar el ratón.");
        }


    });
</script>

</body>

</html>